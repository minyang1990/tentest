<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWTè°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .result {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .jwt-parts {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .jwt-part {
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .header-part {
            background-color: #ffebee;
            border: 1px solid #f8bbd9;
        }
        .payload-part {
            background-color: #e8f5e8;
            border: 1px solid #c8e6c9;
        }
        .signature-part {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” JWTè°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h3>ğŸ“ è¾“å…¥JWTä»¤ç‰Œ</h3>
            <textarea id="jwtInput" placeholder="è¯·è¾“å…¥JWTä»¤ç‰Œ...">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJ1c2VySWQiOiIxIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzUzNTAxOTA2LCJleHAiOjE3NTM1MDU1MDZ9.TeZb5XgjTJdMUFiLsGg01QNrTbUyPVsmQGdYcpZ9_08</textarea>
            <button onclick="decodeJWT()">è§£ç JWT</button>
            <button onclick="clearInput()">æ¸…ç©º</button>
        </div>

        <div class="section">
            <h3>ğŸ”§ JWTç»“æ„åˆ†æ</h3>
            <div id="jwtStructure" class="result">ç‚¹å‡»"è§£ç JWT"æŒ‰é’®å¼€å§‹åˆ†æ...</div>
            <div class="jwt-parts" id="jwtParts" style="display: none;">
                <div class="jwt-part header-part">
                    <strong>Header:</strong>
                    <div id="headerPart"></div>
                </div>
                <div class="jwt-part payload-part">
                    <strong>Payload:</strong>
                    <div id="payloadPart"></div>
                </div>
                <div class="jwt-part signature-part">
                    <strong>Signature:</strong>
                    <div id="signaturePart"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ” ç­¾åéªŒè¯</h3>
            <label for="secretKey">å¯†é’¥ (ä¸åç«¯ä¿æŒä¸€è‡´):</label>
            <textarea id="secretKey" placeholder="è¯·è¾“å…¥ç­¾åå¯†é’¥...">SuperSecureJwtKeyForDemoApplication2024WithAtLeast256BitsLength!@#$%^&*()</textarea>
            <button onclick="verifySignature()">éªŒè¯ç­¾å</button>
            <div id="verificationResult" class="result">è¾“å…¥å¯†é’¥å¹¶ç‚¹å‡»"éªŒè¯ç­¾å"æŒ‰é’®...</div>
        </div>

        <div class="section">
            <h3>ğŸ“Š JWT.io å…¼å®¹æ€§æ£€æŸ¥</h3>
            <div id="jwtioInfo" class="result">è§£ç JWTåæ˜¾ç¤ºJWT.ioä½¿ç”¨è¯´æ˜...</div>
        </div>
    </div>

    <script>
        let currentJWT = null;

        function decodeJWT() {
            const jwtInput = document.getElementById('jwtInput').value.trim();
            if (!jwtInput) {
                showResult('jwtStructure', 'è¯·è¾“å…¥JWTä»¤ç‰Œ', 'error');
                return;
            }

            try {
                const parts = jwtInput.split('.');
                if (parts.length !== 3) {
                    showResult('jwtStructure', `JWTæ ¼å¼é”™è¯¯ï¼šåº”è¯¥æœ‰3ä¸ªéƒ¨åˆ†ï¼Œå®é™…æœ‰${parts.length}ä¸ªéƒ¨åˆ†`, 'error');
                    return;
                }

                currentJWT = {
                    raw: jwtInput,
                    header: parts[0],
                    payload: parts[1],
                    signature: parts[2]
                };

                // è§£ç Headerå’ŒPayload
                const headerDecoded = JSON.parse(base64UrlDecode(parts[0]));
                const payloadDecoded = JSON.parse(base64UrlDecode(parts[1]));

                // æ˜¾ç¤ºç»“æ„åˆ†æ
                let structureInfo = `JWTç»“æ„åˆ†ææˆåŠŸï¼\n\n`;
                structureInfo += `æ€»é•¿åº¦: ${jwtInput.length} å­—ç¬¦\n`;
                structureInfo += `Headeré•¿åº¦: ${parts[0].length} å­—ç¬¦\n`;
                structureInfo += `Payloadé•¿åº¦: ${parts[1].length} å­—ç¬¦\n`;
                structureInfo += `Signatureé•¿åº¦: ${parts[2].length} å­—ç¬¦\n\n`;
                structureInfo += `Headerå†…å®¹:\n${JSON.stringify(headerDecoded, null, 2)}\n\n`;
                structureInfo += `Payloadå†…å®¹:\n${JSON.stringify(payloadDecoded, null, 2)}\n\n`;
                
                // æ—¶é—´ä¿¡æ¯
                if (payloadDecoded.iat) {
                    const issuedAt = new Date(payloadDecoded.iat * 1000);
                    structureInfo += `ç­¾å‘æ—¶é—´: ${issuedAt.toLocaleString()}\n`;
                }
                if (payloadDecoded.exp) {
                    const expiresAt = new Date(payloadDecoded.exp * 1000);
                    const now = new Date();
                    const isExpired = now > expiresAt;
                    structureInfo += `è¿‡æœŸæ—¶é—´: ${expiresAt.toLocaleString()} ${isExpired ? '(å·²è¿‡æœŸ)' : '(æœ‰æ•ˆ)'}\n`;
                }

                showResult('jwtStructure', structureInfo, 'success');

                // æ˜¾ç¤ºJWTå„éƒ¨åˆ†
                document.getElementById('headerPart').textContent = parts[0];
                document.getElementById('payloadPart').textContent = parts[1];
                document.getElementById('signaturePart').textContent = parts[2];
                document.getElementById('jwtParts').style.display = 'grid';

                // æ˜¾ç¤ºJWT.ioä½¿ç”¨è¯´æ˜
                showJWTioInfo(headerDecoded, payloadDecoded);

            } catch (error) {
                showResult('jwtStructure', `è§£ç å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function verifySignature() {
            if (!currentJWT) {
                showResult('verificationResult', 'è¯·å…ˆè§£ç JWTä»¤ç‰Œ', 'error');
                return;
            }

            const secretKey = document.getElementById('secretKey').value.trim();
            if (!secretKey) {
                showResult('verificationResult', 'è¯·è¾“å…¥å¯†é’¥', 'error');
                return;
            }

            try {
                // é‡æ–°æ„å»ºå¾…ç­¾åæ•°æ®
                const dataToSign = `${currentJWT.header}.${currentJWT.payload}`;
                
                // ä½¿ç”¨Web Crypto APIè¿›è¡ŒHMAC-SHA256è®¡ç®—
                const encoder = new TextEncoder();
                const keyData = encoder.encode(secretKey);
                const data = encoder.encode(dataToSign);

                crypto.subtle.importKey(
                    'raw',
                    keyData,
                    { name: 'HMAC', hash: 'SHA-256' },
                    false,
                    ['sign']
                ).then(key => {
                    return crypto.subtle.sign('HMAC', key, data);
                }).then(signature => {
                    const signatureArray = new Uint8Array(signature);
                    const expectedSignature = base64UrlEncode(signatureArray);
                    
                    let result = `ç­¾åéªŒè¯ç»“æœ:\n\n`;
                    result += `å¾…ç­¾åæ•°æ®: ${dataToSign}\n\n`;
                    result += `ä½¿ç”¨å¯†é’¥: ${secretKey.substring(0, 20)}...\n\n`;
                    result += `æœŸæœ›ç­¾å: ${expectedSignature}\n`;
                    result += `å®é™…ç­¾å: ${currentJWT.signature}\n\n`;
                    
                    if (expectedSignature === currentJWT.signature) {
                        result += `âœ… ç­¾åéªŒè¯æˆåŠŸï¼JWTä»¤ç‰Œæœ‰æ•ˆä¸”æœªè¢«ç¯¡æ”¹ã€‚`;
                        showResult('verificationResult', result, 'success');
                    } else {
                        result += `âŒ ç­¾åéªŒè¯å¤±è´¥ï¼å¯èƒ½åŸå› ï¼š\n`;
                        result += `1. å¯†é’¥ä¸æ­£ç¡®\n`;
                        result += `2. JWTä»¤ç‰Œè¢«ç¯¡æ”¹\n`;
                        result += `3. ç­¾åç®—æ³•ä¸åŒ¹é…`;
                        showResult('verificationResult', result, 'error');
                    }
                }).catch(error => {
                    showResult('verificationResult', `ç­¾åéªŒè¯è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
                });

            } catch (error) {
                showResult('verificationResult', `éªŒè¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showJWTioInfo(header, payload) {
            let info = `JWT.io ä½¿ç”¨è¯´æ˜:\n\n`;
            info += `1. è®¿é—® https://jwt.io/\n`;
            info += `2. åœ¨å·¦ä¾§"Encoded"åŒºåŸŸç²˜è´´æ‚¨çš„JWTä»¤ç‰Œ\n`;
            info += `3. åœ¨å³ä¸‹è§’"VERIFY SIGNATURE"åŒºåŸŸè¾“å…¥å¯†é’¥:\n`;
            info += `   SuperSecureJwtKeyForDemoApplication2024WithAtLeast256BitsLength!@#$%^&*()\n\n`;
            info += `4. ç¡®ä¿ç®—æ³•é€‰æ‹©ä¸º: ${header.alg || 'HS256'}\n\n`;
            info += `æ³¨æ„: JWT.ioé»˜è®¤ä½¿ç”¨ "your-256-bit-secret" ä½œä¸ºå¯†é’¥ï¼Œ\n`;
            info += `æ‚¨éœ€è¦æ›¿æ¢ä¸ºæˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨çš„å®é™…å¯†é’¥æ‰èƒ½éªŒè¯æˆåŠŸã€‚`;
            
            showResult('jwtioInfo', info, 'warning');
        }

        function clearInput() {
            document.getElementById('jwtInput').value = '';
            document.getElementById('jwtStructure').textContent = 'ç‚¹å‡»"è§£ç JWT"æŒ‰é’®å¼€å§‹åˆ†æ...';
            document.getElementById('jwtStructure').className = 'result';
            document.getElementById('jwtParts').style.display = 'none';
            document.getElementById('verificationResult').textContent = 'è¾“å…¥å¯†é’¥å¹¶ç‚¹å‡»"éªŒè¯ç­¾å"æŒ‰é’®...';
            document.getElementById('verificationResult').className = 'result';
            document.getElementById('jwtioInfo').textContent = 'è§£ç JWTåæ˜¾ç¤ºJWT.ioä½¿ç”¨è¯´æ˜...';
            document.getElementById('jwtioInfo').className = 'result';
            currentJWT = null;
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        function base64UrlDecode(str) {
            // å°†Base64URLè½¬æ¢ä¸ºæ ‡å‡†Base64
            let base64 = str.replace(/-/g, '+').replace(/_/g, '/');
            
            // æ·»åŠ å¿…è¦çš„å¡«å……
            while (base64.length % 4) {
                base64 += '=';
            }
            
            // è§£ç 
            const decoded = atob(base64);
            return decoded;
        }

        function base64UrlEncode(arrayBuffer) {
            const bytes = new Uint8Array(arrayBuffer);
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            const base64 = btoa(binary);
            return base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è§£ç ç¤ºä¾‹JWT
        window.onload = function() {
            decodeJWT();
        };
    </script>
</body>
</html>